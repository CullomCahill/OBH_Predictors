---
title: "OBH paper draft"
author: "Elements Wilderness Program Research Team"
date: "9/19/2021"
output:
  pdf_document: default
  html_document: default
---

# Potential Predictors of OBH Client Success

Analysis of adolescents attending Outdoor Behavioral Healthcare (OBH) programs which are part of the National Association of Therapeutic Schools and Programs Practice Research Network (NATSAP PRN) in the United States.  For more information visit natsap.org and obhcouncil.com.  

The following is detailed explanation of a working paper to be submitted for peer review to the Journal of Residential Treatment for Children & Youth.  

## Objective  

To determine if there are any significant predictors of if a given adolescent client will succeed in OBH treatment.  All clients were given the Youth Outcome Questionnaire (YOQ) at both intake and discharge, a peer reviewed measurement frequently used to assess mental health functioning in adolescents.  Finding the change between the intake and discharge scores can be used to determine if the client met the Reliable Change Index (RCI).  Previous studies have found that meeting the RCI corresponds to a clinically significant change in the individual, that is a behavioral and mood change that is apparent both to the individual and those in contact with the individual.  

"Success" in this paper is defined as a client meeting the Reliable Change Index (RCI) when their intake and discharge scores were compared.


## Data Setup  

```{r setup, include = FALSE}
# Removes all code from the output

library(tidyverse)
library(janitor) # For tabyl
library(knitr) # for kable

knitr::opts_chunk$set(echo = FALSE)

# Load OBH NATSAP dataset and name "obh"
obh <- readRDS("C:/Users/cullo/OneDrive/Desktop/One Cloud/Resume 2022/Github Portfolio/rds/obh_for_logistic.rds")



```

**To view the cleaning script for this file, please visit "OBH cleaning.R" on Github**


# Sample

## Predictor Variable Selection

Predictor variables used in this study were selected based on presence in other OBH studies.  

* gender  

* adopted  

* attention_issue  

* autism  

* conduct_disorder  

* depression  

* substance_abuse  

* trauma_related_issue  

* program_need  

* change_desire  

* prior_prog  

* progress_need  

* Routine Monitoring Status

* transport  

* Rel01 intake difference z score  



## Demographics

Only dichotomous variables that were present in more than 5% of the sample were included in this study.

```{r freq_select vars}
obh <- obh %>% select(-c(bi_polar, eating_disorder, gender_dysphoria, learning_disability, ocd_disorders, personality_disorders, psychotic_disorders))

# New freq table with updated inputs
freq_tabs_list1 <- lapply(obh[,c(1, 5:13, 18)], tabyl) 

# Bring this list of tables together into a central table
freq_tab_rm <- data.table::rbindlist(freq_tabs_list1, fill = TRUE, idcol=TRUE)

# Tidy up
freq_tab_rm <- freq_tab_rm %>% rename(variable = `.id`, response = `X[[i]]`) %>% 
  mutate(percent = round(percent*100, 2)) %>% 
  select(-valid_percent)

kable(freq_tab_rm)

```

## Reliable Change Index (RCI)

The dependent variable used in this study was whether or not the client met the RCI cutoff from intake to discharge according to their own self report YOQ-SR scores.  The dummy variable, “rci” was coded as “Yes” for adolescents who showed a change of 18 points or more after the intervention and coded as “No” for adolescents who reported a change of less than 18 points, in congruence with the defined RCI for the YOQ Youth Self Report.

```{r RCI}
# obh$delta_client = Discharge YOQ score (D0) - Intake YOQ Score (A0)
#  if D0 - A0 <= -18 then client has met the RCI, because their change score meets/exceeds requirements

obh$rci <- ifelse(obh$delta_client <= -18, 1, 0)

# Create table of students who met rci and did not
rci_tab <- obh %>% group_by(rci) %>% tally() %>% mutate(perc = round(n/2470*100,2))

kable(rci_tab)

```

## Clinical Change Categories



```{r change cat formula, echo = TRUE}
# Note, this is already done preemptively on rds file, just to see process

example_formula <- obh %>% 
  mutate(change_cat_client =
           case_when(delta_client <= -18 & client_YOQ_20SR_D0_SCORE <= 46 ~ "rec", # recovered
                     delta_client <= -18 & client_YOQ_20SR_D0_SCORE >= 47 ~ "imp", # improved
                     delta_client >= -17 & delta_client <= 0 & 
                       client_YOQ_20SR_D0_SCORE >= 47 ~ "unch", # unchanged
                     delta_client >= 1 & client_YOQ_20SR_D0_SCORE >= 47 ~ "det", # deteriorated
                     delta_client >= -17 & delta_client <= 0 & client_YOQ_20SR_D0_SCORE <= 46 ~ "nocl", # non-clinical
                     delta_client >= 1 & client_YOQ_20SR_D0_SCORE <= 46 ~ "nocl")) 


```






## YOQ Mean scores by RCI

## Likert Variable Mean Scores by RCI
```{r}
# Means of 0/1 for likert variables

likert_mean_tab <- obh %>% group_by(rci) %>% 
  summarise(program_need_mean = mean(program_need, na.rm = TRUE),
            program_need_sd = sd(program_need, na.rm = TRUE),
            change_desire_mean = mean(change_desire, na.rm = TRUE),
            change_desire_sd = sd(change_desire, na.rm = TRUE),
            prior_prog_mean = mean(prior_prog, na.rm = TRUE),
            prior_prog_sd = sd(prior_prog, na.rm = TRUE),
            progress_need_mean = mean(progress_need, na.rm = TRUE),
            progress_need_sd = sd(progress_need, na.rm = TRUE))


likert_mean_tab



```



# Variable Setup

## Intake Difference Variable Setup




